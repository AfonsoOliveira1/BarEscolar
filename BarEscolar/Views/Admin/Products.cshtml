@model IEnumerable<BarEscolar.Models.Product>

@{
    ViewData["Title"] = "Produtos";
}

<h2 class="page-title">Produtos</h2>

<center><a class="btn btn-success mb-3" asp-action="CreateProduct">Novo Produto</a><center/>

<div class="filters-container">
    <div class="filter-box">
        <label for="categoryFilter">Categoria</label>
        <select id="categoryFilter" class="filter-select">
            <option value="">Filtrar Categoria</option>
            @foreach (Category category in ViewBag.Categories)
            {
                <option value="@category.Name">@category.Name</option>
            }
        </select>
    </div>

    <div class="filter-box">
        <label for="priceFilter">Preço</label>
        <select id="priceFilter" class="filter-select">
            <option value="">Filtrar Preço</option>
            <option value="low">Menor para Maior</option>
            <option value="high">Maior para Menor</option>
        </select>
    </div>

    <div class="filter-box">
        <label for="allergenFilter">Alergénios</label>
        <input id="allergenFilter" class="filter-input" type="text" placeholder="ex: leite, glúten..." />
    </div>
</div>

<!-- Tabela dos produtos AJAX -->
<div id="productList" class="product-list-wrapper">
    @await Html.PartialAsync("_ProductList", Model)
</div>

<script>
    document.getElementById("categoryFilter").addEventListener("change", loadFiltered);
    document.getElementById("priceFilter").addEventListener("change", loadFiltered);
    document.getElementById("allergenFilter").addEventListener("input", loadFiltered);

    function loadFiltered() {
        const category = document.getElementById("categoryFilter").value;
        const price = document.getElementById("priceFilter").value;
        const allergen = document.getElementById("allergenFilter").value;

        fetch(`/Admin/LoadProducts?id=@ViewBag.User.ID&category=${category}&price=${price}&allergen=${allergen}`)
            .then(response => response.text())
            .then(html => {
                document.getElementById("productList").innerHTML = html;
            });
    }
</script>
