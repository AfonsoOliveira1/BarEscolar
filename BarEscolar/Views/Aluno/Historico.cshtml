@model IEnumerable<BarEscolar.Models.OrderItem>

@{
    ViewData["Title"] = "Histórico de Marcação";
    var allMenus = ViewBag.AllMenus as List<BarEscolar.Models.MenuDay>;
}

<h1>Histórico de Marcação — @ViewBag.User.FullName</h1>

<a asp-action="Index" asp-route-id="@ViewBag.User.ID" class="btn btn-primary mb-3">
    Voltar aos Menus
</a>

@if (!Model.Any())
{
    <p>Não existem marcações no histórico.</p>
}
else
{
    <table class="table table-striped">
        <thead>
            <tr>
                <th>Data</th>
                <th>Prato Principal</th>
                <th>Tipo</th>
                <th>Sobremesa</th>
                <th>Sopa</th>
                <th>Status</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var item in Model)
            {
                var menu = allMenus?.FirstOrDefault(m => m.Id == item.Productid);
                if (menu != null)
                {
                    <tr>
                        <td>@menu.Date.ToShortDateString()</td>
                        <td>@menu.MainDish</td>
                        <td>@(menu.option == "A" ? "Não-Vegan" : "Vegan")</td>
                        <td>@menu.Dessert</td>
                        <td>@menu.Soup</td>
                        <td>
                            @if (item.Quantity == 0)
                            {
                                <span class="text-danger">Cancelado</span>
                            }
                            else if (menu.Date.Date < DateTime.Today)
                            {
                                <span class="text-muted">Concluído</span>
                            }
                            else
                            {
                                <span class="text-success">Marcado</span>
                            }
                        </td>
                    </tr>
                }
            }
        </tbody>
    </table>
}
